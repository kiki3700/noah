<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.noah.app.quant.mapper.ItemMapper">
	<select id = 'selectItemDtoList' parameterType ='HashMap' resultType = 'com.noah.app.vo.ItemDto'>
		SELECT *
			FROM ITEM A
			 LEFT JOIN (SELECT ITEM_ID FROM HISTORY_DATA GROUP BY(ITEM_ID) HAVING COUNT(*) > 255 ) B ON A.ID = B.ITEM_ID
			WHERE IS_ACTIVE ='CPC_STOCK_STATUS_NORMAL'
			<if test = "market !=null and market!=''">
				AND A.MARKET = #{market}
			</if>
			<if test = "industry != null and industry != ''">
				AND A.industry = #{industry}
			</if>
			<if test = "corpSize != null and corpSize!= ''">
				And A.corp_size = #{corpSize}
			</if>
			<if test = "baseYear != null">
                AND
				B.ITEM_ID IS NOT NULL
			</if>
	</select>
	

	<!-- 지워버릴것  -->
	<select id = "selectHistoryDataList" parameterType = "HashMap" resultType ="com.noah.app.vo.HistoryDataDto">
		
			SELECT 
			*
            FROM(SELECT * FROM HISTORY_DATA WHERE ITEM_ID = #{itemDto.id}
            ORDER BY TRADING_DATE DESC) T 
 			WHERE 1=1
            	<choose>
            		<when test ="period != null">
            			AND ROWNUM <![CDATA[  <= ]]> #{period} 
            		</when>
            		<otherwise>
						AND ROWNUM <![CDATA[  <= ]]> 255
					</otherwise>
				</choose>
	</select>
</mapper>